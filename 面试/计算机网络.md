# 计算机网络笔记

# IP



# TCP

## TCP 拥塞控制算法

1.   **慢启动（Slow Start）**：慢启动是刚刚建立连接时，速率逐渐上升的过程。它并不慢，每接收到一个ack，窗口指数级增长，直到达到了**慢启动阈值**或者丢包。

2.   **拥塞避免（Congestion Avoidance）**：当慢启动阶段结束，TCP就会进入拥塞避免阶段。每当收到一个RTT内的所有ack，拥塞窗口增加一个**MSS**（最大段长度）。

3.   **快重传（Fast Retransmit）**：正常情况下，tcp发送一个数据包后，会等待一段时间，如果达到了超时阈值，就会重新发送超时数据包以后的所有数据包。但是为了解决等待时间过长的问题，tcp引入了快重传机制，当发送方连续收到三个重复的ack时，直接重新发送可能丢失的数据包。

4.   **快恢复（Fast Recovery）**：快恢复是为了和快重传配合使用。tcp发生快重传后，tcp立即进行快恢复。tcp将慢启动阈值和当前窗口设置为拥塞时的一半，然后进入拥塞避免阶段。

     

## TCP协议的滑动窗口

滑动窗口是tcp拥塞控制的一部分，发送方通过调整发送窗口来控制自己的发送速率，防止缓存溢出。接收方收到数据后，会向发送方发送确认数据包。当发送方接收到确认包，发送方会将窗口向前滑动，并改变自己的窗口大小。当一个数据包超时，发送方会重新发送所有未确认的数据包，并且减小自己的窗口大小。



## TCP的长连接和短连接

1. **短连接**是指客户端与服务器每进行一次交互就重新建立连接，交互完就断开连接。短连接的优点是不需要在服务器上维护状态，节省了服务器资源。然而，短连接需要在每次交互进行三次握手和四次挥手，这增加了网络开销，可能导致网络拥塞。
1. **长连接**是指客户端与服务器的连接一旦开始，就会保持开启状态，直到服务器或客户端要求关闭或者因为网络错误而断开。这种连接适合需要频繁交互的场景，例如客户端向服务器请求多个文件。



## TCP三次握手

第三次握手可以传送数据，因为第三次握手时，客户端进入了ESTABVLISHED状态。当ack到达服务端，服务端也进入了连接建立的状态。

<img src="../images/TCP三次握手.drawio.webp" width="600">







## TCP四次挥手



## 四次挥手释放连接时需要等待2MSL

`MSL` 是 Maximum Segment Lifetime，**报文最大生存时间**，设置为2MSL可以保证报文已经在网络中消失，不会与新的连接产生冲突。



<img src="../images/format,png-20230309230614791.webp" width="600">







## TCP的粘包、拆包

什么是粘包？ 发生拥塞时，数据包同时到达接收方，导致接收方收到了[tcp + 数据1]+[tcp + 数据2]、[tcp + 数据3]。 而tcp头没有携带数据包长度，因此传输层找不到数据的边界。

拆包相反，数据包变成了 [IP首部 + TCP首部 + 数据前半部分] 和 [IP首部 + TCP首部 + 数据后半部分]



它们都采用同一套解决方法：

1.   发送端给每个数据包添加包首部，首部中应该至少包含数据包的长度，这样接收端在接收到数据后，通过读取包首部的长度字段，便知道每一个数据包的实际长度了。

2.   发送端将每个数据包封装为固定长度（不够的可以通过补0填充），这样接收端每次从接收缓冲区中读取固定长度的数据就自然而然的把每个数据包拆分开来。

3.   可以在数据包之间设置边界，如添加特殊符号，这样，接收端通过这个边界就可以将不同的数据包拆分开。



## SYN 攻击

SYN攻击即利用TCP协议的缺陷，通过发送大量的半连接请求，占用半连接队列。耗费CPU和网络资源。

解决方法：1. 缩短超时时间。 2. 对于同一个ip的多次半连接请求，直接拒绝。



# UDP
# HTTP/HTTPS

## HTTP方法类型

##### OPTIONS：

这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用’*'来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。

##### HEAD：

与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。

##### GET：

向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作中，例如在Web Application中。其中一个原因是GET可能会被网络蜘蛛等随意访问。参见安全方法

##### POST：

向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。

##### PUT：

向指定资源位置上传其最新内容。

##### DELETE：

请求服务器删除Request-URI所标识的资源。

##### TRACE：

回显服务器收到的请求，主要用于测试或诊断。

##### CONNECT：

HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。通常用于SSL加密服务器的链接（经由非加密的HTTP代理服务器）。



## http和https的联系与区别

http传输过程为明文，传输过程的任何设备都能查看数据包的内容，导致数据发生泄密。而https在http上建立SSL或TLS的安全层。因此https具有http的所有特性，并且加入了数据加密、身份验证和完整性保护的能力。

**加密过程**：

<img src="../images/network1.png" width="600" height="图片高度">





## 简述HTTP/1.0

1.   规定了请求头和请求尾，响应头和响应尾（get，post）。

2.   每个请求都是一个单独的连接，不能做到连接复用。

     

## 简述HTTP/1.1

HTTP/1.1 相对HTTP/1.0的主要提升有：持久连接、管道化请求和响应、新增了一些方法和状态代码，以及对cookie的协商和支持。



## 简述HTTP/2.0

1.   **二进制协议**：HTTP/2.0是基于二进制的，而不是基于文本的，这使得数据包的解析更高效、更准确、更易于实现。
2.   **多路复用**：在HTTP/2.0中，所有的请求都在一个tcp连接中，该连接承载了所有的双向数据流。这样可以避免HTTP/1.1中对头阻塞的问题，提高网页的加载速度。
3.   **首部压缩**：采用HPACK算法对头字段进行压缩。减少传输冗余。
4.   **服务器推送**：服务器可以在客户端请求之前就将资源推送给客户端。这样可以进一步提高加载速度。以前都是等客户端请求html结束后，客户端再发送css和图片的请求。现在服务器可以在发送html同时，发送css和图片，无需等待客户端来请求。
5.   **流量控制和优先级**：HTTP/2.0还引入了流量控制和优先级机制。客户端和服务器都可以决定数据流的处理顺序。



## get 和 post 的区别

**get**将请求的内容放在url中，传输的数据大小受到url限制。根据HTTP/1.1规范get请求不应该改变服务器的状态，因此是刷新无害的。

**post**向指定资源提交需要处理的数据。post先发送请求头给服务器确认，然后再发送实际请求的数据。







## session

session用于标记特定客户端的信息，存在服务器的一个文件里。一般客户端都会带cookie对服务器访问，然后服务器通过cookie中的session id来获取特定的session。



## cookie

http协议本身是无状态的，http 1.1引入cookie来保持状态信息。服务器发送cookie给客户端，然后客户端保存cookie。客户端每次发送请求都会携带cookie，服务端根据cookie来辨识客户端，以此来提供个性化推荐、免登录等功能。





## HTTP的状态码和对应的信息

1XX：接收的信息正在处理

2XX：请求正常处理完毕

3XX：重定向

4XX：客户端错误

5XX：服务端错误

常见错误码： 301：永久重定向 302：临时重定向 304：资源没修改，用之前缓存就行 400：客户端请求的报文有错误 403：表示服务器禁止访问资源 404：表示请求的资源在服务器上不存在或未找到



# 应用层的其他协议



## 转发和重定向的区别

**转发**是服务器的行为，用户浏览器的url不变。服务器访问目标url，然后返回给浏览器。

**重定向**是服务器向浏览器返回状态码来实现的。浏览器接收到301或302状态码，会自动跳转到新的url来请求。





# 网络综合

## 五层模型各自的用途

1.   **应用层**：它为应用程序提供了一个接口，使得应用程序直接可以相互通讯。包括http、SMTP、FTP等。
2.   **传输层**：它通过TCP、UDP提供了端到端的通信服务，包括拥塞控制、端到端纠错。其中TCP提供可靠的数据传输，而UDP提供不可靠的数据传输。
3.   **网络层**：它负责数据包的发送和接受。包括数据包的路由（觉得数据包的路径）和网络互联（连接不同的网络）。它使用的协议包括ICMP和IP协议。
4.   **数据链路层**：它负责两个节点之间的数据传输。数据链路层的功能包括数据帧的生成、错误检测和修正。它使用的协议包括Ethernet、PPP等。
5.   **物理层**：它负责在硬件设备上传输0和1比特流。这包括了设备的物理特性的定义和控制。物理层是网络的基础。



## 在浏览器输入网址到网页显示，期间发生的事情

1.   **浏览器解析url**： url包括了三个部分，第一，协议，可能是http或https。 第二，web服务器，可能是ip地址或域名。第三：资源路径和名称，这部分可以忽略。如果忽略了资源路径和名称，那么就是请求服务器的默认文件，例如index.html
2.   **查询ip地址**：因为ip地址难以记忆，互联网的大部分网站都是用域名来替代ip地址。因此浏览器需要通过DNS协议来获取域名对应的ip地址，从而生成数据包。客户端首先查询**本地DNS服务器**，如果本地DNS服务器缓存了，就直接告诉客户端域名对应的ip地址。如果本地DNS服务器不存在，客户端会询问根DNS服务器哪里可以查询到，根服务器会告诉客户端顶级域名服务器的位置。于是客户端查询**顶级域名服务器**，顶级域名服务器会回应权威服务器的地址。最终，**权威DNS服务器**会告诉客户端域名对应的ip地址。

3.   **tcp的三次握手**：得到了ip地址，客户端就可以向这个ip地址发送报文。发送报文之前，客户端需要与服务器进行三次握手，从而建立tcp连接。
4.   **客户端解析数据**：客户端通过tcp获取到了服务器的数据后，通过浏览器解析报文成用户可以识别的文字或图片。





## 会话层和表示层的作用

会话层是OSI模型的第五层，它的作用包括：

1.   对话管理：负责建立和维护会话，以及会话的恢复和同步。
2.   事务管理：在会话中管理数据的交互，确保数据交换的一致性。
3.   传输同步：通过插入检查点，实现在会话中传输数据的同步。
4.   多路复用：运行不同的应用程序或会话共享底层的网络连接。



表示层是OSI模型的第六层，它的作用包括：

1.   数据格式化：将应用层的数据格式转化为网络可以识别的标准格式。也可以从网络标准格式转化为应用层的数据格式。
2.   数据加密和解密：为了数据的安全性。给数据加密和解密。
3.   数据压缩和解压：提高数据传输的效率。



